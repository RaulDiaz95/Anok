# Render Blueprint for Anok Platform
# This file defines all services for staging environment
#
# To use this blueprint:
# 1. Push this file to your repository
# 2. In Render dashboard, go to "Blueprints" and connect your repository
# 3. Render will automatically create all services defined below

databases:
  # Staging Database
  - name: anok-db-staging
    databaseName: anok_db_staging
    plan: free
    region: ohio
    ipAllowList: []

services:

  # Staging Backend API
  - type: web
    name: anok-api-staging
    runtime: docker
    region: ohio
    plan: free
    branch: develop  # Deploy from develop branch (or use 'staging' if you have one)
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    healthCheckPath: /api/actuator/health
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: PORT
        value: 8080
      - key: DB_HOST
        fromDatabase:
          name: anok-db-staging
          property: host
      - key: DB_PORT
        fromDatabase:
          name: anok-db-staging
          property: port
      - key: DB_NAME
        fromDatabase:
          name: anok-db-staging
          property: database
      - key: DB_USER
        fromDatabase:
          name: anok-db-staging
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: anok-db-staging
          property: password
      - key: CORS_ALLOWED_ORIGINS
        value: https://anok-staging.onrender.com  # Update with your staging frontend URL
      - key: ENABLE_SWAGGER_UI
        value: true  # Keep enabled in staging for testing
      - key: ENABLE_API_DOCS
        value: true

  # Staging Frontend
  - type: web
    name: anok-frontend-staging
    runtime: static
    branch: develop
    buildCommand: cd webapp && npm install && npm run build
    staticPublishPath: ./webapp/dist
    envVars:
      - key: VITE_API_URL
        value: https://anok-api-staging.onrender.com/api
    routes:
      - type: rewrite
        source: /*
        destination: /index.html

# Notes:
# 1. All services are using FREE tier plans
# 2. Free tier limitations:
#    - Database: Expires after 90 days, 1GB storage
#    - Web service: Spins down after 15 mins of inactivity (slow cold starts)
#    - Static site: Always free
# 3. After first deployment, update CORS_ALLOWED_ORIGINS with actual frontend URL
# 4. For custom domains, add them in Render dashboard and update URLs accordingly
